pipeline{
    agent any
    environment {
        FOLDER_NAME= 'api'
        CONTAINER_NAME = 'api-app'
        EXTERNAL_APP_PORT = '5000'
        INTERNAL_APP_PORT = '5000'
        CODE_DIR='movie-land'
        IMAGE_NAME='${FOLDER_NAME}'
        TAG = 'v1.${BUILD_NUMBER}'
        ACCOUNT_NAME= 'yit1977ltld/apiproject'
        REGISTRY= 'hub.docker.com'
        DOCKERHUB_CREDENIALS = credentials('DockerCred')

    }    
    stages{
        stage("Terraform Init and Apply") {
            steps {
                dir('Terraform') {
                    sh 'terraform init'
                    sh 'terraform apply -auto-approve'
                }
            }
            post {
                success {
                    echo "Terraform applied successfully"
                }
                failure {
                    echo "Terraform apply failed"
                }
            }
        }
    }
   post{
        always{
        }
        success{
            echo "========pipeline executed successfully ========"
        }
        failure{
            echo "========pipeline execution failed========"
        }
    }
}